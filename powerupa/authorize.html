<!DOCTYPE html>
<html>
<body>
<button id="auth">Authorize</button>

<script src="https://p.trellocdn.com/power-up.min.js"></script>
<script>
const t = TrelloPowerUp.iframe();
const API_KEY = '2724c7e7d9e21b4245805125ff7f7c1a';

window.addEventListener('message', function(e){
  if (e.data?.token) {
    t.set('member','private','token', e.data.token)
      .then(() => t.closePopup());
  }
});

document.getElementById('auth').onclick = function(){
  const url =
    'https://trello.com/1/authorize' +
    '?expiration=never' +
    '&name=My%20Power-Up' +
    '&scope=read,write' +
    '&response_type=token' +
    '&key=' + API_KEY +
    '&return_url=' + encodeURIComponent(
      location.origin + '/powerupa/authorize-success.html'
    );

  window.open(url, '_blank', 'width=720,height=600');
};
</script>
</body>
</html>
