<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Authorize</title>
</head>
<body>
   <button id="auth">Authorize with Trello</button>
  <script>
    //const t = TrelloPowerUp.iframe();

    // ganti API key sorangan
    const API_KEY = '2724c7e7d9e21b4245805125ff7f7c1a';

    const authUrl =
      'https://trello.com/1/authorize' +
      '?expiration=never' +
      '&name=My%20Power-Up' +
      '&scope=read,write' +
      '&response_type=token' +
      '&key=' + API_KEY +
      '&return_url=' + encodeURIComponent(
        'https://randrialdy.github.io/trello-powerup/powerupa/authorize-success.html'
      );

       document.getElementById('auth').onclick = function () {
      // ⭐ ini TOP-LEVEL popup, bukan iframe
      window.open(authUrl, '_blank', 'width=720,height=600');
       };
     // ⬇️ KETIKA REDIRECT BALIK
    const params = new URLSearchParams(location.hash.substring(1));
    const token = params.get('token');

    if (token) {
      t.set('member', 'private', 'token', token)
        .then(() => t.closePopup());
    }
  </script>
</body>
</html>
