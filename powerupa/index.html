<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Power-Up Home</title>
</head>
<body>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    TrelloPowerUp.initialize({
      'board-buttons': function (t) {
        return [{
          text: 'My Power-Up',
          callback: function (t, options) {

            // Cek token di member/private pluginData
            return t.get('member', 'private', 'token')
              .then(function (token) {
                if (token) {
                  // ✅ SUDAH AUTH → JANGAN TAMPILKAN AUTHORIZE
                  return t.alert({
                    message: 'Authorized ✅',
                    duration: 3
                  });
                }

                // ❌ BELUM AUTH → MUNCUL AUTHORIZE
                return t.popup({
                  title: 'Authorize Power-Up',
                  url: './authorize.html?v=10',
                  height: 200,
                  mouseEvent: options.mouseEvent
                });
              });
          }
        }];
      }
    });
  </script>
</body>
</html>
